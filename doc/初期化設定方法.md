# 固定粒子数 (N=60) に合わせた $\mu$ 初期値の見積もり（調和トラップ / 2D格子）

## 目的

BdG-SCF の外側ループ（化学ポテンシャル探索）で、初期値 `mu-initial` が悪いと **高コストなSCF（対角化）** を何度も回すことになる。
そこで、**対角化なし** ($\mu$) の初期推定値を与える。

---

## 前提（今回の設定）

設定ファイル例（抜粋）：

* 格子：($L_x=L_y=28$)、2D、周期境界
* ホッピング：($t=1.0$)
* 目標総粒子数：($N=60$)
* トラップ：トロイダル成分なし（$\omega_{tr}=0$）
  $$
  V(r)=\frac12\omega_{ho}\left(\frac{r}{r_0}\right)^2
  $$
  今回は `omegaHo=1.0, r0=1.0`

---

## 1. 粗い解析見積もり（式で出す：低充填近似）

### 1.1 局所化学ポテンシャル（LDA）

外部ポテンシャル下で、局所的に
$$
\mu_{\text{eff}}(r) = \mu - V(r)
$$
とみなす（局所密度近似：LDA）。

### 1.2 格子のバンド底

2D正方格子の最近接ホッピング（(t)）では、単粒子エネルギーの下限は
$$
E_{\min} = -4t
$$
したがって、粒子が入る目安は $\mu_{\text{eff}}(r) \gtrsim -4t$ である。

### 1.3 低充填（バンド底近傍）での密度近似

バンド底近傍を連続近似すると（2Dの放物線近似）、総密度（成分和）の目安は
$$
n_{\text{tot}}(r)\approx \frac{\mu_{\text{eff}}(r)+4t}{2\pi t}
\quad (\mu_{\text{eff}}>-4t)
$$
（※係数は近似。目的は「初期値のオーダー」を得ること。）

### 1.4 積分で総粒子数 (N) を見積もる

$$
N \approx \int n_{\text{tot}}(r) d^2r
$$
ポテンシャル
$$
V(r)=\frac12\omega_{ho}\left(\frac{r}{r_0}\right)^2
$$
を代入し、$\mu_{\text{eff}}(r)>-4t$ の領域まで積分すると、ざっくり
$$
N \approx \frac{(\mu+4t)^2 r_0^2}{2\omega_{ho}t}
$$
が得られる。

### 1.5 $\mu$ の初期値（逆算）

$$
\mu_{\text{initial}}
\approx -4t + \frac{\sqrt{2\omega_{ho}tN}}{r_0}
$$

---

## 2. 数値例（今回のパラメータ）

* $t=1.0$
* $\omega_{ho}=1.0$
* $r_0=1.0$
* $N=60$

$$
\sqrt{2\omega_{ho}tN}=\sqrt{2\cdot 1\cdot 1\cdot 60}=\sqrt{120}\approx 10.954
$$

$$
\mu_{\text{initial}}\approx -4 + 10.954 = 6.954
$$

**結論：`mu-initial` は概ね 7 前後が粗い見積もり。**

---

## 3. 注意点（この式が外れる理由）

この見積もりは「初期値のオーダー」を得る目的であり、以下でズレる：

* 格子の厳密DOS（連続近似ではない）
* 相互作用（Hartree項やBdG自己無撞着）による実効シフト
* 温度が有限でフェルミ分布がなまる
* トラップが有限サイズ格子上で切れる（端効果）

したがって、SCF後に最適 ($\mu$) は 7 からずれることがある（例：8～9に寄る等）。

## 4. まとめ（資料用の一言）

* 調和トラップ $V(r)=\frac12\omega_{ho}(r/r_0)^2$ の下で、低充填近似から
  $$
  \mu_{\text{initial}}\approx -4t + \frac{\sqrt{2\omega_{ho}tN}}{r_0}
  $$
  と見積もれる。
* 今回（$t=1,\omega_{ho}=1,r_0=1,N=60)$）では **($\mu_{\text{initial}}\approx 6.95$)**。
* さらに精度よく・安くやるなら、`Potential#valueAt` を使って **対角化なしの LDA 二分法**で ($\mu$) を前処理推定する。
